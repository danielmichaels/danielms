<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="SSH in a nutshell Date: 28 Jan 2018 Status: published Tags:ssh  Category:administration    SSH Definition Straight from the man pages:
ssh (SSH client) is a program for logging into a remote machine and for executing commands on a remote machine. It is intended to provide secure encrypted communications between two untrusted hosts over an insecure network. X11 connections, arbitrary TCP ports and UNIX-domain sockets can also be forwarded over the secure channel.">

<meta property="og:title" content="" />
<meta property="og:description" content="SSH in a nutshell Date: 28 Jan 2018 Status: published Tags:ssh  Category:administration    SSH Definition Straight from the man pages:
ssh (SSH client) is a program for logging into a remote machine and for executing commands on a remote machine. It is intended to provide secure encrypted communications between two untrusted hosts over an insecure network. X11 connections, arbitrary TCP ports and UNIX-domain sockets can also be forwarded over the secure channel." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/blog/02-ssh/" />

















<title>


      

</title>
<link rel="canonical" href="http://example.org/blog/02-ssh/">










<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="/css/main.css">
    




<link rel="shortcut icon"

    href="/img/favicon.ico"

>








</head>


<body lang="">

<section class="header">
    <div class="container">
        <div class="content">
            
            <a href="/"><div class="name"></div></a>
            
            <nav>
                <ul>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        

        

        

	

        

        

        

        

        

        

        

        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    

</div>

                    <div class="initials"><a href="http://example.org/"></a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Mon Jan 1 0001 00:00:00 UTC'>Jan 1, 0001</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>6 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <div class="document" id="ssh-in-a-nutshell">
<h1 class="title">SSH in a nutshell</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Date:</th>
<td>28 Jan 2018</td></tr>
<tr><th class="docinfo-name">Status:</th>
<td>published</td></tr>
<tr class="tags field"><th class="docinfo-name">Tags:</th><td class="field-body">ssh</td>
</tr>
<tr class="category field"><th class="docinfo-name">Category:</th><td class="field-body">administration</td>
</tr>
</tbody>
</table>
<div class="section" id="ssh">
<h2>SSH</h2>
<div class="section" id="definition">
<h3>Definition</h3>
<p>Straight from the man pages:</p>
<p><em>ssh (SSH client) is a program for logging into a remote machine and for
executing commands on a remote machine. It is intended to provide secure
encrypted communications between two untrusted hosts over an insecure
network. X11 connections, arbitrary TCP ports and UNIX-domain sockets
can also be forwarded over the secure channel.</em></p>
<div class="section" id="setup-old-school-method">
<h4>Setup (Old School Method)</h4>
<p>On a new machine we need to setup up ssh. This includes installation if
its not installed by default (i.e.&nbsp;Arch Linux). It also includes the
creation of our private and public keys (maybe write a post about the
basics of pgp).</p>
<p>To create a new key we use <code>ssh-keygen</code>. Taken straight from the man
pages:</p>
<ul class="simple">
<li><strong>ssh-keygen</strong> generates, manages and converts authentication keys
for ssh. It can create keys for use by SSH protocols versions one and
two. Protocol one is depreciated and should not be used.</li>
</ul>
<p>When creating a key we need to specify the type. To do this we use the
<code>-t</code> flag followed by one of the following specifications:</p>
<ul class="simple">
<li>RSA, DSA, ECDSA, ED25519</li>
</ul>
<p>If no flag is present it will default to RSA which is what we want.</p>
<p>Also important is the number of bits in the key to generate. By default
it will generate a key length of 2048 bits. In this article we will not
discuss non-RSA configurations which require different lengths (refer to
the man pages for more info). Generally it is recommended to use 4096
bits of entropy, to do that we use the <code>-b</code> followed by the number, in
this case 4096.</p>
<p>Running <code>ssh-keygen -t rsa -b 4096</code> will create the ssh key.</p>
<div class="figure">
<img alt="SSH commandline" src="{filename}/images/sshcmdline.png" />
</div>
<p>It will ask for a password, this is up to the user but it does not limit
your ability to login without entering password as we discuss below. It
does however, offer protection should your device be stolen or
compromised. The password can be bruteforced but it will give you time
to manually for to your administered servers and delete the public key
that matches the now stolen private key.</p>
</div>
<div class="section" id="key-based-authentication">
<h4>Key Based Authentication</h4>
<p>Key based authentication allows seamless interaction between disparate
hosts over the network. Generally, to ssh into a remote server the
client will need to enter the servers password. Using ssh keys (unless
they too are configured with a password) negates this.</p>
<p>Below we see how to transfer the clients public key to the remote
server.</p>
<pre class="code bash literal-block">
scp ~/.ssh/id_rsa.pub user&#64;remote.server.org:/home/user/.ssh/clients_public_key.pub
</pre>
<p><code>scp</code> is the Secure Copy program. It uses ssh for the data transfer
and provides the same security. The basic syntax is to call <code>scp</code> then
append the file to be copied, followed by the destination to send it to.
The destination is punctuated by a colon <code>:</code> coupled with the location
on the remote server in which the file should be saved to (as seen
above).</p>
<p>Next we need to authorize the key we have sent to the remote server. If
we do not authorize it, it will not allow us to login using the key,
i.e.&nbsp;we will be prompted for a password each time. To do that we can
input the following:</p>
<p><code>cat ~/.ssh/name_of_new_key.pub &gt;&gt; ~/.ssh/authorized_keys</code></p>
<p>Firstly, in linux we do not need to append a file name at the end so
this works as expected. And secondly, the <code>&gt;&gt;</code> will create the file
for us if it does not already exist.</p>
<p>Finally, it is important to set permissions on the new directory and its
keys. Permissions is another topic, but we want the following:</p>
<pre class="literal-block">
chmod 700 /home/user
chmod 700 /home/user/.ssh
chmod 600 /home/user/.ssh/authorized_keys
</pre>
<p>We want our <code>/home</code> and <code>/home/.ssh</code> to have read, write and execute
only by the user and <code>../authorized_keys</code> only read and writable by
the user. This is on the remote server. We can also now delete the
public key from within <code>~/.ssh/</code> as it is saved to the authorized keys
although this is optional.</p>
</div>
<div class="section" id="setup-v2-new-school">
<h4>Setup V2 (New School)</h4>
<p>After explaining the old way or more traditional (sometimes better) way
we turn to <code>ssh-copy-id</code>.</p>
<p>To do all of that in one command we can just enter:</p>
<pre class="code bash literal-block">
ssh-copy-id user&#64;remote_server
</pre>
<p>And, it will do everything in about 2 seconds (after you authenticate
with the remotes password). To test it without committing anything use
the <code>-n</code> flag (dry run). It is important to know what is happening in
the background though, so do the old school method to get a better feel
for linux – if you are old hat, just use this.</p>
</div>
<div class="section" id="further-security-measures">
<h4>Further Security Measures</h4>
<p><strong>Disable Password Authentication</strong></p>
<p>After we have setup key based authentication on the remote server we may
want to close off all non-key authenticated access via ssh. This means
that only those with authorized keys will be able to access the server.
In a home network this may be overkill (dependent on the situation or
security posture/threat model you need, or face) but if you are using
ssh to administer a VPS this should be the minimum standard.</p>
<p>To do this we need to edit our <code>/etc/ssh/sshd_config</code> <strong>back it up
first!</strong>.</p>
<p>To do this we just change <code>PasswordAuthentication</code> to <code>no</code> inside
the file. After the change we need to restart the ssh daemon to make the
change immediate.</p>
<p><strong>Change SSH Default Port</strong></p>
<p>Many of the automated botnets automatically search the web looking for
open ports, and exploiting them by entering common default credentials.
Whilst changing the ssh port from 22 to something else is security by
obscurity it does enough to make elevate you above the ‘low hanging
fruit’ category.</p>
<p>To alter the default port the <code>sshd_config</code> needs to be edited.</p>
<pre class="literal-block">
#Port 22 &lt;---- Uncomment this and change port
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::
</pre>
<p>You need to be root to do this. And the ssh daemon must be restarted.
<code>systemctl restart sshd.service</code> on systemd.</p>
<p><strong>Auto Deny/Fail2Ban</strong></p>
<p>To access a host via ssh it needs to be open over the network. This is
adds risk and creates an attack vector. <em>fail2ban</em> is a service that
attempts to mitigate this by altering your firewalls configuration after
a set number of unsuccessful login attempts.</p>
<p><strong>Port Knocking</strong></p>
<p>A method to surreptitiously open the port to ssh. By making connection
attempts (“knocking”) on ports in a predefined manner the firewall
allows access to ssh. Again, this is security through obscurity but
coupled with several strategies does help to harden the system. Nmap can
ascertain if a host has port knocking enabled.</p>
</div>
</div>
</div>
</div>
                <br>
                
                <p class="back-to-posts"><a href="/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                
            </div>
            
        </div>
    </div>
</section>









</body>
</html>

