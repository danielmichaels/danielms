<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Daniel Michaels">
<meta name="description" content="Wagtail Embed Video Wagtail is a brilliant content management service built atop of Django. It comes with all of Django&rsquo;s functionality and Django Rest Framework built in for headless work making life a lot easier.
In all, I really love it, especially its StreamFields. But I did stumble on one component, getting embedded videos to work correctly.
Embedding videos This is harder than I feel it should be and poorly explained by the Wagtail documentation.">

<meta property="og:title" content="Wagtail embeded YouTube videos" />
<meta property="og:description" content="Wagtail Embed Video Wagtail is a brilliant content management service built atop of Django. It comes with all of Django&rsquo;s functionality and Django Rest Framework built in for headless work making life a lot easier.
In all, I really love it, especially its StreamFields. But I did stumble on one component, getting embedded videos to work correctly.
Embedding videos This is harder than I feel it should be and poorly explained by the Wagtail documentation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://danielms.site/blog/wagtail-embedurl-youtube-tags/" />
<meta property="article:published_time" content="2020-01-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-25T00:00:00+00:00" />


<title>


     Wagtail embeded YouTube videos 

</title>
<link rel="canonical" href="https://danielms.site/blog/wagtail-embedurl-youtube-tags/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="https://danielms.site/css/reset.css?t=2020-04-12%2021%3a41%3a30.245875298%20%2b1000%20AEST%20m%3d%2b0.408253745">
    <link rel="stylesheet" href="https://danielms.site/css/pygments.css?t=2020-04-12%2021%3a41%3a30.245875298%20%2b1000%20AEST%20m%3d%2b0.408253745">
    <link rel="stylesheet" href="https://danielms.site/css/main.css?t=2020-04-12%2021%3a41%3a30.245875298%20%2b1000%20AEST%20m%3d%2b0.408253745">
    




<link rel="shortcut icon"

    href="https://danielms.site/extra/favicon.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                
                <a href="https://danielms.site/"><img class="avatar" src="https://danielms.site/extra/cover.jpeg" srcset="https://danielms.site/extra/cover.jpeg 1x"></a>
            
            <a href="https://danielms.site/"><div class="name">Daniel Michaels</div></a>
            
              <h3 class="self-intro">I forget things so I write them down.</h3>
            
            <nav>
                <ul>
                    
                        <li class="nav-blog"><a href="https://danielms.site/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-about"><a href="https://danielms.site/about/"><span>About</span></a></li>
                    
                        <li class="nav-code"><a href="https://github.com/danielmichaels"><span>Code</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/danielmichaels" target="_blank" rel="noopener"><img class="icon" src="https://danielms.site/img/github.svg" alt="github" /></a>
        

        

        
            <a href="//twitter.com/extrapancakes_" target="_blank" rel="noopener"><img class="icon" src="https://danielms.site/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        

        

        
            <a href="//instagram.com/extrapancakes_" target="_blank" rel="noopener"><img class="icon" src="https://danielms.site/img/instagram.svg" alt="instagram" /></a>
        

        

        

        
            <a href="mailto:danielms@danielms.site"><img class="icon" src="https://danielms.site/img/email.svg" alt="email" /></a>
        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    Wagtail embeded YouTube videos

</div>

                    <div class="initials"><a href="https://danielms.site/">ad</a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Sat Jan 25 2020 00:00:00 UTC'>Jan 25, 2020</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>3 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <h2 id="wagtail-embed-video">Wagtail Embed Video</h2>
<p><img src="https://danielms.site/images/wagtail-logo.png" alt="" title="wagtail icon"></p>
<p>Wagtail is a brilliant content management service built atop of Django. It comes with all of Django&rsquo;s functionality and Django Rest Framework built in for headless work making life a lot easier.</p>
<p>In all, I really love it, especially its <a href="https://docs.djangoproject.com/en/dev/howto/custom-template-tags/">StreamFields</a>. But I did stumble on one component, getting embedded videos to work correctly.</p>
<h3 id="embedding-videos">Embedding videos</h3>
<p>This is harder than I feel it should be and poorly explained by the Wagtail documentation. Perhaps too harsh, in a sense - the documentation is actually really good. Except for in the circumstance whereby you want to render an embedded video inside your own HTML and CSS.</p>
<p>Before, covering that, again I should mention that wagtail&rsquo;s documentation is excellent and so too is their implementation of this Framework. For instance, you <em>can</em> render an embed video &lsquo;block&rsquo; by calling a template tag and creating the component in the model.</p>
<p>Except, it will <strong>always</strong> render this block inside a custom CSS div which apparently cannot be overridden. I&rsquo;d wager 8 out of 10 times this might mess with your sites style.</p>
<h3 id="custom-embedding-of-video-content">Custom embedding of video content</h3>
<p>There is a solution to this issue; just call the <em>video.url</em> within your own implementation of an iframe element. Except, if its YouTube, and your are using a URL such as <a href="https://www.youtube.com/watch?v=xUWd3o6z2bk,">https://www.youtube.com/watch?v=xUWd3o6z2bk,</a> it will likely not run. Why? It&rsquo;s the <em>watch</em> url endpoint. YouTube, wants embedded videos to use <a href="https://www.youtube.com/embed?v=xUWd3o6z2bk">https://www.youtube.com/embed?v=xUWd3o6z2bk</a> instead. <strong>Note</strong> the use of <em>embed</em> in place of <em>watch</em>.</p>
<p>And, wagtail will not accept YouTube urls containing <em>embed</em> causing a template error. So what&rsquo;s a person to do; custom template tags to override this blocker!</p>
<h3 id="code-or-gtfo">Code or GTFO</h3>
<p>Lets create a VideoBlock that will embed a video component into our template.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># blocks.py</span>
<span class="k">class</span> <span class="nc">VideoBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Only used for Video Card modals.&#34;&#34;&#34;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">EmbedBlock</span><span class="p">()</span> <span class="c1"># &lt;-- the part we need</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&#34;streams/video_card_block.html&#34;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;media&#34;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Embed Video&#34;</span>
</code></pre></div><p>This will now give us a StreamField which we can then use to enter the url we wish to embed into the template. In this example the url we are entering into our StreamField video_card_block is <a href="https://www.youtube.com/watch?v=xUWd3o6z2bk">https://www.youtube.com/watch?v=xUWd3o6z2bk</a></p>
<p>Next, in the video block template we&rsquo;ll use Bootstrap&rsquo;s embedded video component and inject the url into the <em>src</em> attribute.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!--  video_card_block.html --&gt;</span>
{% load wagtailcore_tags wagtailembeds_tags %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ self.video.url }}?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></div><p>Unfortunately, this will render it as seen below, and be blocked by YouTube. In fact when it is blocked, you will need to consult dev tools to see that wagtail did indeed render the HTML.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://www.youtube.com/watch/zpOULjyy-n8?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><p>To fix this we need to create a <a href="https://docs.djangoproject.com/en/dev/howto/custom-template-tags/">custom template tag</a> which will intercept the <em>watch</em> url and inject the <em>embed</em> url into the template. This will make wagtail&rsquo;s embed <a href="https://github.com/wagtail/wagtail/blob/master/wagtail/embeds/oembed_providers.py">classifiers</a> happy and us too.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register.filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;embedurl&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_embed_url_with_parameters</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&#34;youtube.com&#34;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">or</span> <span class="s2">&#34;youtu.be&#34;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;(?:https:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(.+)&#34;</span>  <span class="c1"># Get video id from URL</span>
        <span class="n">embed_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="n">regex</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&#34;https://www.youtube.com/embed/\1&#34;</span><span class="p">,</span> <span class="n">url</span>
        <span class="p">)</span>  <span class="c1"># Append video id to desired URL</span>
        <span class="k">print</span><span class="p">(</span><span class="n">embed_url</span><span class="p">)</span>
        <span class="n">embed_url_with_parameters</span> <span class="o">=</span> <span class="n">embed_url</span> <span class="o">+</span> <span class="s2">&#34;?rel=0&#34;</span>  <span class="c1"># Add additional parameters</span>
        <span class="k">return</span> <span class="n">embed_url_with_parameters</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div><p>This will now render the <em>embed</em> url as expected and upon inspection with dev tools should look like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://www.youtube.com/embed/zpOULjyy-n8?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><h3 id="fixed">fixed</h3>
<p>I Searched the internet for hours and only after piecing it together over time did I eventually unlock this riddle! This is still an <a href="https://github.com/wagtail/wagtail/issues/4127">open</a> ticket on the tail issue tracker!</p>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="https://danielms.site/tags/python">python</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="https://danielms.site/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                
            </div>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-149607103-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

