<!DOCTYPE html>
<html lang="en" data-theme=""><head>
    <title> Daniel Michaels | Wagtail embeded YouTube videos </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.80.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="I build things and drink coffee.">
    
    <link rel="stylesheet"
          href="https://danielms.site/css/style.min.9a6700e4461b50dccdddfc4f81dc65d77e7fca22c35665e398a0c36568db59c7.css"
          integrity="sha256-mmcA5EYbUNzN3fxPgdxl135/yiLDVmXjmKDDZWjbWcc="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://danielms.site/css/markupHighlight.min.cc84ed683057cc175ddfa738ea6ba2d5c882b95cb64f50bf9be918cb3791887b.css"
        integrity="sha256-zITtaDBXzBdd36c46mui1ciCuVy2T1C/m&#43;kYyzeRiHs="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://danielms.site/extra/favicon.icofavicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://danielms.site/extra/favicon.icoapple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://danielms.site/extra/favicon.icofavicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://danielms.site/extra/favicon.icofavicon-16x16.png">

    <link rel="canonical" href="https://danielms.site/blog/wagtail-embedurl-youtube-tags/">

    
    
    
    
    <script type="text/javascript"
            src="https://danielms.site/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            integrity="sha256-2Fme4Ht9PxG6&#43;6wwZXzMWR6Nf9Nqn1gM1MCeJODkqXE="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="https://danielms.site/js/anatole-theme-switcher.min.e289e9ebb2a4e7a7f895859c8a2b0da2de1ec73f22cea58d8475aa0597023837.js"
                integrity="sha256-4onp67Kk56f4lYWciisNot4exz8izqWNhHWqBZcCODc="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Wagtail embeded YouTube videos"/>
<meta name="twitter:description" content="Wagtail Embed Video Wagtail is a brilliant content management service built atop of Django."/>


    
    <meta property="og:title" content="Wagtail embeded YouTube videos" />
<meta property="og:description" content="Wagtail Embed Video Wagtail is a brilliant content management service built atop of Django." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://danielms.site/blog/wagtail-embedurl-youtube-tags/" />
<meta property="article:published_time" content="2020-01-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-25T00:00:00+00:00" /><meta property="og:site_name" content="Daniel Michaels ðŸ‡¦ðŸ‡º" />

</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="https://danielms.site/extra/cover.jpeg" alt="profile picture">
            <h3 title=""><a href="/">Daniel Michaels ðŸ‡¦ðŸ‡º</a></h3>
            <div class="description">
                <p>I build things and drink coffee.</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://linkedin.com/in/daniel-michaels" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/danielmichaels/" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.twitter.com/dansult/" rel="me" aria-label="twitter">
                    <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:dan@mudmap.io" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Daniel Michaels  2018-2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/blog/"
                        
                   title="">Blog</a></li>
        
            
            <li><a 
                   href="/retrospectives/"
                        
                   title="">Retrospectives</a></li>
        
            
            <li><a 
                   href="/projects/"
                        
                   title="">Projects</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
            <div class="post-title">
                <h3>Wagtail embeded YouTube videos</h3>
                
            </div>

            <h2 id="wagtail-embed-video">Wagtail Embed Video</h2>
<p><img src="/images/wagtail-logo.png" alt="" title="wagtail icon"></p>
<p>Wagtail is a brilliant content management service built atop of Django. It comes with all of Django&rsquo;s functionality and Django Rest Framework built in for headless work making life a lot easier.</p>
<p>In all, I really love it, especially its <a href="https://docs.djangoproject.com/en/dev/howto/custom-template-tags/">StreamFields</a>. But I did stumble on one component, getting embedded videos to work correctly.</p>
<h3 id="embedding-videos">Embedding videos</h3>
<p>This is harder than I feel it should be and poorly explained by the Wagtail documentation. Perhaps too harsh, in a sense - the documentation is actually really good. Except for in the circumstance whereby you want to render an embedded video inside your own HTML and CSS.</p>
<p>Before, covering that, again I should mention that wagtail&rsquo;s documentation is excellent and so too is their implementation of this Framework. For instance, you <em>can</em> render an embed video &lsquo;block&rsquo; by calling a template tag and creating the component in the model.</p>
<p>Except, it will <strong>always</strong> render this block inside a custom CSS div which apparently cannot be overridden. I&rsquo;d wager 8 out of 10 times this might mess with your sites style.</p>
<h3 id="custom-embedding-of-video-content">Custom embedding of video content</h3>
<p>There is a solution to this issue; just call the <em>video.url</em> within your own implementation of an iframe element. Except, if its YouTube, and your are using a URL such as <a href="https://www.youtube.com/watch?v=xUWd3o6z2bk,">https://www.youtube.com/watch?v=xUWd3o6z2bk,</a> it will likely not run. Why? It&rsquo;s the <em>watch</em> url endpoint. YouTube, wants embedded videos to use <a href="https://www.youtube.com/embed?v=xUWd3o6z2bk">https://www.youtube.com/embed?v=xUWd3o6z2bk</a> instead. <strong>Note</strong> the use of <em>embed</em> in place of <em>watch</em>.</p>
<p>And, wagtail will not accept YouTube urls containing <em>embed</em> causing a template error. So what&rsquo;s a person to do; custom template tags to override this blocker!</p>
<h3 id="code-or-gtfo">Code or GTFO</h3>
<p>Lets create a VideoBlock that will embed a video component into our template.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># blocks.py</span>
<span class="k">class</span> <span class="nc">VideoBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Only used for Video Card modals.&#34;&#34;&#34;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">EmbedBlock</span><span class="p">()</span> <span class="c1"># &lt;-- the part we need</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&#34;streams/video_card_block.html&#34;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;media&#34;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Embed Video&#34;</span>
</code></pre></div><p>This will now give us a StreamField which we can then use to enter the url we wish to embed into the template. In this example the url we are entering into our StreamField video_card_block is <a href="https://www.youtube.com/watch?v=xUWd3o6z2bk">https://www.youtube.com/watch?v=xUWd3o6z2bk</a></p>
<p>Next, in the video block template we&rsquo;ll use Bootstrap&rsquo;s embedded video component and inject the url into the <em>src</em> attribute.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!--  video_card_block.html --&gt;</span>
{% load wagtailcore_tags wagtailembeds_tags %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ self.video.url }}?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></div><p>Unfortunately, this will render it as seen below, and be blocked by YouTube. In fact when it is blocked, you will need to consult dev tools to see that wagtail did indeed render the HTML.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://www.youtube.com/watch/zpOULjyy-n8?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><p>To fix this we need to create a <a href="https://docs.djangoproject.com/en/dev/howto/custom-template-tags/">custom template tag</a> which will intercept the <em>watch</em> url and inject the <em>embed</em> url into the template. This will make wagtail&rsquo;s embed <a href="https://github.com/wagtail/wagtail/blob/master/wagtail/embeds/oembed_providers.py">classifiers</a> happy and us too.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register.filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;embedurl&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_embed_url_with_parameters</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&#34;youtube.com&#34;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">or</span> <span class="s2">&#34;youtu.be&#34;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;(?:https:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(.+)&#34;</span>  <span class="c1"># Get video id from URL</span>
        <span class="n">embed_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="n">regex</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&#34;https://www.youtube.com/embed/\1&#34;</span><span class="p">,</span> <span class="n">url</span>
        <span class="p">)</span>  <span class="c1"># Append video id to desired URL</span>
        <span class="k">print</span><span class="p">(</span><span class="n">embed_url</span><span class="p">)</span>
        <span class="n">embed_url_with_parameters</span> <span class="o">=</span> <span class="n">embed_url</span> <span class="o">+</span> <span class="s2">&#34;?rel=0&#34;</span>  <span class="c1"># Add additional parameters</span>
        <span class="k">return</span> <span class="n">embed_url_with_parameters</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div><p>This will now render the <em>embed</em> url as expected and upon inspection with dev tools should look like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive embed-responsive-16by9&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;embed-responsive-item&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://www.youtube.com/embed/zpOULjyy-n8?rel=0&#34;</span> <span class="na">allowfullscreen</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><h3 id="fixed">fixed</h3>
<p>I Searched the internet for hours and only after piecing it together over time did I eventually unlock this riddle! This is still an <a href="https://github.com/wagtail/wagtail/issues/4127">open</a> ticket on the tail issue tracker!</p>
</div>
        <div class="post-footer">
            <div class="info">
                <span class="separator"><a class="category" href="/categories/python/">python</a><a class="category" href="/categories/django/">Django</a></span>

                <span class="separator"><a class="tag" href="/tags/python/">python</a></span>

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://danielms.site/js/jquery.min.86b1e8f819ee2d9099a783e50b49dff24282545fc40773861f9126b921532e4c.js"
        integrity="sha256-hrHo&#43;BnuLZCZp4PlC0nf8kKCVF/EB3OGH5EmuSFTLkw="
        crossorigin="anonymous"></script>




<script type="text/javascript"
        src="https://danielms.site/js/bundle.min.0f9c74cb78f13d1f15f33daff4037c70354f98acfbb97a6f61708966675c3cae.js"
        integrity="sha256-D5x0y3jxPR8V8z2v9AN8cDVPmKz7uXpvYXCJZmdcPK4="
        crossorigin="anonymous"></script>

<script type="text/javascript"
        src="https://danielms.site/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-149607103-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</body>

</html>
