<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name=" robots" content="noindex, nofollow">
<title>Web Scraping Javascript with Python | Daniel Michaels | Software Developer</title>

<meta name="keywords" content="python, web" />
<meta name="description" content="Scraping Dynamic Pages with Python Web scraping Python is a great tool for web scraping tasks, it is efficient, easy to read and fast. Whenever looking to grab data from a site, the canonical packages are BeautifulSoup and Requests. Unfortunately, when our target site is dynamically rendered, BeautifulSoup can&rsquo;t &ldquo;see&rdquo; those parts leading to a lot of head scratching. The often touted answer to this is Selenium which spins up a browser thereby rendering the JavaScript making it possible to scrape data from it.">
<meta name="author" content="Daniel Michaels">
<link rel="canonical" href="https://danielms.site/blog/web-scraping-javascript-with-python-xhr/" />
<link href="https://danielms.site/assets/css/stylesheet.min.08d6f2005b6ce4ed10207916c0411c66e66f2201e3f7a56e8fb2ccbc4a8b259c.css" integrity="sha256-CNbyAFts5O0QIHkWwEEcZuZvIgHj96Vuj7LMvEqLJZw=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://danielms.site/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://danielms.site/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://danielms.site/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://danielms.site/apple-touch-icon.png">
<link rel="mask-icon" href="https://danielms.site/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.78.1" />




</head>

<body class="single" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://danielms.site/" accesskey="h">Daniel Michaels | Software Developer</a>
            <span class="logo-switches">
                <span class="theme-toggle">
                    <a id="theme-toggle" accesskey="t">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </a>
                </span>
                
            </span>
        </div>
        <ul class="menu" id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://danielms.site/blog/">
                    <span>
                        Blog
                    </span>
                </a>
            </li>
            <li>
                <a href="https://danielms.site/about/">
                    <span>
                        About
                    </span>
                </a>
            </li>
            <li>
                <a href="https://github.com/danielmichaels">
                    <span>
                        Code
                    </span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      Web Scraping Javascript with Python
    </h1>
    <div class="post-meta">

March 13, 2020&nbsp;Â·&nbsp;Daniel Michaels

    </div>
  </header> 

  <div class="post-content">
<h1 id="scraping-dynamic-pages-with-python">Scraping Dynamic Pages with Python<a hidden class="anchor" aria-hidden="true" href="#scraping-dynamic-pages-with-python">#</a></h1>
<p><img src="https://danielms.site/images/scraping.png" alt="" title="web scraping diagram"></p>
<h2 id="web-scraping">Web scraping<a hidden class="anchor" aria-hidden="true" href="#web-scraping">#</a></h2>
<p>Python is a great tool for web scraping tasks, it is efficient, easy to read and fast. Whenever looking to grab data from a site, the canonical packages are <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> and <a href="https://github.com/psf/requests/">Requests</a>. Unfortunately, when our target site is dynamically rendered, BeautifulSoup can&rsquo;t &ldquo;see&rdquo; those parts leading to a lot of head scratching. The often touted answer to this is <a href="https://selenium-python.readthedocs.io/">Selenium</a> which spins up a browser thereby rendering the JavaScript making it possible to scrape data from it.</p>
<p>While selenium does work it kinda sucks, can be a pain to setup and introduces more complexity. On big projects where scrolling, pagination or link traversal is required you may be best served by using Selenium. Though I would recommend <a href="https://scrapy.org/">Scrapy</a>, which is excellent and is built for scraping - Selenium is not.</p>
<p>In some cases, there is another way.</p>
<h2 id="an-alternative">An alternative<a hidden class="anchor" aria-hidden="true" href="#an-alternative">#</a></h2>
<p>Many modern web applications render data from third party API&rsquo;s or other backend services. When a site uses JavaScript to do this, then we can get a lot of data from it by using only Requests, <a href="https://www.postman.com/">Postman</a> and <a href="https://curl.haxx.se/">cURL</a>.</p>
<p>The basic steps:</p>
<ul>
<li>find the API endpoint using the browser&rsquo;s development tools,</li>
<li>copy the URL as a curl command,</li>
<li>import that command into postman, checking it works,</li>
<li>get postman to auto generate the request into Python code, and</li>
<li>plug that into your script, and profit!</li>
</ul>
<p>This will provide you repeatable python code which will always return a response with the data you require.</p>
<h3 id="step-1-find-the-url">Step 1: Find the URL<a hidden class="anchor" aria-hidden="true" href="#step-1-find-the-url">#</a></h3>
<p>Let&rsquo;s use an example <a href="https://lic-investing.online">website</a> which uses an <a href="https://en.wikipedia.org/wiki/XMLHttpRequest">XMLHttpRequest</a> pull data from another server and populate a table with stock data.</p>
<p>After navigating to the site, open the development tools and click on the network pane. You may need to refresh the page to populate the network pane with its requests.</p>
<p>Searching through the requests, we find what we are looking for, in this case the requests are named after the stock symbols. There is no standard but you can filter by XHR in the network pane to make finding juicy targets easier.</p>
<p>For the uninitiated, when clicking on the XHR request, select the response pane and look at the JSON data it has returned.</p>
<p><img src="https://danielms.site/images/scrape-net-tab.png" alt="" title="dev tools network tab with json xhr response data"></p>
<h3 id="step-2-copy-as-curl">Step 2: Copy as cURL<a hidden class="anchor" aria-hidden="true" href="#step-2-copy-as-curl">#</a></h3>
<p>After finding the appropriate XHR endpoint, we now need to replicate the GET request.</p>
<p>In the network tab, as seen above, right click and hover over <em>Copy</em> which will show you an option to <em>Copy as cURL</em>. Selecting this will output something like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">curl <span class="s1">&#39;https://lic-investing.online/api/stocks/bki&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:74.0) Gecko/20100101 Firefox/74.0&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;Accept: application/json, text/plain, */*&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;Accept-Language: en-US,en;q=0.5&#39;</span> --compressed <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;DNT: 1&#39;</span> -H <span class="s1">&#39;Connection: keep-alive&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;Referer: https://lic-investing.online/&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;Pragma: no-cache&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;Cache-Control: no-cache&#39;</span> <span class="se">\
</span><span class="se"></span>-H <span class="s1">&#39;TE: Trailers&#39;</span>
<span class="c1"># formatted for easier reading</span>
</code></pre></div><p>You can test that this works by running the command in your console on MacOS or Linux. On Windows? ðŸ¤· soz, I don&rsquo;t know.</p>
<h3 id="step-3-import-into-postman">Step 3: Import into Postman<a hidden class="anchor" aria-hidden="true" href="#step-3-import-into-postman">#</a></h3>
<p>After copying as cURL above, open up <a href="https://www.postman.com/">Postman</a>.</p>
<p>In the top left will be a orange box titled <em>New</em>, and to the right of it will be <em>Import</em>. Select <em>Import</em> and then click on the <em>Paste Raw Text</em> tab. Paste in the cURL command and hit <em>Import</em>. This process should resemble the image below.</p>
<p><img src="https://danielms.site/images/scrape-postman.png" alt="" title="Postman import raw text example"></p>
<p>After importing the command, Postman will populate all the GET parameters needed to make a request in its main window. Clicking on the blue <em>Send</em> button will fire the request and once Postman receives the response you will see it in the main body of the screen.</p>
<p>Right now we have returned a JSON object from our target without needing to be on their website proving we can simulate a request from their frontend to the backend. This is how we will scrape the site in a repeatable and reliable way.</p>
<h3 id="step-4-get-the-python-code">Step 4: Get the python code<a hidden class="anchor" aria-hidden="true" href="#step-4-get-the-python-code">#</a></h3>
<p>So far, we&rsquo;ve created a request to retrieve data from the server. But now we need to turn this request into something we can replicate using Python.</p>
<p>Let&rsquo;s use Postman to automatically generate some Python code for us.</p>
<p>To get this auto generated code simply select the <em>Code</em> text block which is directly below the <em>Save</em> drop-down on the right hand side of Postman&rsquo;s main screen.</p>
<p>Scroll down to find Python code nicely generated for us. In this example I have chosen Requests, though it also offers <code>http.client</code> as well.</p>
<p><img src="https://danielms.site/images/scrape-python.png" alt="" title="Postman code auto generator example"></p>
<h3 id="step-5-win">Step 5: Win<a hidden class="anchor" aria-hidden="true" href="#step-5-win">#</a></h3>
<p>Now we have fully functional Python code which can make a request to the endpoint we are targeting and it will return a response as if we were the website. What we do now is pure business logic but the main thing is we did not need to reach for Selenium, and that is worth its weight in code.</p>
<h2 id="closing-points">Closing points<a hidden class="anchor" aria-hidden="true" href="#closing-points">#</a></h2>
<p>Be wary of hitting the endpoint repeatedly, you may get black listed by the site. To prevent this, use a library such as <a href="https://github.com/reclosedev/requests-cache">Requests-cache</a>. Give them a star if you can!</p>
<p>This is also helpful when playing with API&rsquo;s which have request or rate limits imposed.</p>
<p>Not related to XHR but always look over the source of a webpage in a browser, and then contrast that with BeautifulSoup&rsquo;s response data. I have had success on React sites by grabbing their Props data that I couldn&rsquo;t even see rendered in the browser. To get at custom, hard to scrape data like this, Regex is your friend.</p>
<p>If its on the internet, its possible to scrape (within legal limits of course).</p>

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://danielms.site/tags/python">python</a></li>
      <li><a href="https://danielms.site/tags/web">web</a></li>
    </ul>
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2020 <a href="https://danielms.site/">Daniel Michaels | Software Developer</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top" accesskey="g">
    <button class="top-link" id="top-link" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6">
            <path d="M12 6H0l6-6z" /></svg>
    </button>
</a>



<script defer src="https://danielms.site/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                behavior: "smooth"
            });
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
