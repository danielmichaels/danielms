+++
title = "TIL about fmt.Appendf"
categories = ["zet"]
tags = ["zet"]
slug = "til-about-fmt.appendf"
date = "2025-11-24 00:00:00 +0000 UTC"
draft = "false"
ShowToc = "true"
mermaid = "true"
+++

# TIL about fmt.Appendf

Turn this:

```go
request := []byte(fmt.Sprintf(`{"request_id":%d}`, rand.Int63()))
```

Into 

```go
request := fmt.Appendf(nil, `{"request_id":%d}`, rand.Int63())
```

I really like this; much simpler to type and quite clean in mu opinion. 

Another benefit is reduced allocations. It allows us to extend a byte slice instead of generating new ones.

The source is quite easy to understand IMO 

```go
// ref: https://cs.opensource.google/go/go/+/master:src/fmt/print.go;l=247

// Appendf formats according to a format specifier, appends the result to the byte
// slice, and returns the updated slice.
func Appendf(b []byte, format string, a ...any) []byte {
	p := newPrinter()
	p.doPrintf(format, a)
	b = append(b, p.buf...)
	p.free()
	return b
}
```

Tags:

    #go #til
